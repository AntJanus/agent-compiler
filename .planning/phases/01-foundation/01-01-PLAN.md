---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/types/skill.ts
  - src/types/command.ts
  - src/types/discovery.ts
  - src/utils/path-resolver.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript project compiles without errors"
    - "Types accurately represent skill and command data structures"
    - "Tilde paths expand to absolute paths correctly"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "fast-glob"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "outDir"
    - path: "src/types/skill.ts"
      provides: "Skill data structure types"
      exports: ["Skill", "SkillMetadata", "ParsedSkill"]
    - path: "src/types/command.ts"
      provides: "Command data structure types"
      exports: ["Command", "ParsedCommand"]
    - path: "src/types/discovery.ts"
      provides: "Discovery result types"
      exports: ["DiscoveredFile", "DiscoveryLocation"]
    - path: "src/utils/path-resolver.ts"
      provides: "Path resolution with tilde expansion"
      exports: ["expandTilde", "resolveSkillsDir", "resolveCommandsDir"]
  key_links:
    - from: "src/utils/path-resolver.ts"
      to: "os.homedir()"
      via: "Node.js os module"
      pattern: "homedir\\(\\)"
---

<objective>
Initialize TypeScript project structure with core type definitions and path utilities.

Purpose: Establish the foundational infrastructure that all discovery and parsing code will build upon.
Output: Compilable TypeScript project with types for skills, commands, and discovery results, plus path resolution utilities.
</objective>

<execution_context>
@/Users/antonin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/antonin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize TypeScript project with dependencies</name>
  <files>package.json, tsconfig.json</files>
  <action>
    1. Create package.json with:
       - name: "agent-compiler"
       - version: "0.1.0"
       - type: "module" (ES modules)
       - main: "dist/index.js"
       - bin: { "agent-compiler": "dist/cli.js" }
       - scripts: { "build": "tsc", "dev": "tsc --watch" }
       - devDependencies: typescript, @types/node
       - dependencies: fast-glob, gray-matter, js-yaml

    2. Create tsconfig.json with:
       - target: "ES2022"
       - module: "NodeNext"
       - moduleResolution: "NodeNext"
       - outDir: "dist"
       - rootDir: "src"
       - strict: true
       - declaration: true
       - esModuleInterop: true

    3. Run `npm install` to install dependencies

    Note: Use ES modules (type: module) for modern Node.js compatibility.
  </action>
  <verify>
    - `npm run build` succeeds (may warn about no files yet)
    - package-lock.json exists
    - node_modules/ contains fast-glob, gray-matter, js-yaml
  </verify>
  <done>
    Project compiles and all dependencies installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create type definitions for skills, commands, and discovery</name>
  <files>src/types/skill.ts, src/types/command.ts, src/types/discovery.ts, src/types/index.ts</files>
  <action>
    1. Create src/types/skill.ts:
       ```typescript
       export interface SkillMetadata {
         name: string;
         description: string;
         [key: string]: unknown;
       }

       export interface ParsedSkill {
         path: string;
         location: 'global' | 'project';
         metadata: SkillMetadata;
         content: string;
         referencedFiles: string[];
       }

       export interface Skill {
         name: string;
         description: string;
         location: 'global' | 'project';
         content: string;  // Final concatenated content
       }
       ```

    2. Create src/types/command.ts:
       ```typescript
       export interface ParsedCommand {
         path: string;
         name: string;
         content: string;
       }

       export interface Command {
         name: string;
         content: string;
       }
       ```

    3. Create src/types/discovery.ts:
       ```typescript
       export type DiscoveryLocation = 'global' | 'project';

       export interface DiscoveredFile {
         path: string;
         location: DiscoveryLocation;
       }

       export interface DiscoveryResult {
         skills: DiscoveredFile[];
         commands: DiscoveredFile[];
       }
       ```

    4. Create src/types/index.ts that re-exports all types:
       ```typescript
       export * from './skill.js';
       export * from './command.js';
       export * from './discovery.js';
       ```

    Note: Use .js extension in imports for ES module compatibility with Node.js.
  </action>
  <verify>
    - `npm run build` compiles without errors
    - dist/types/ contains compiled .js and .d.ts files
  </verify>
  <done>
    All types defined and project compiles.
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement path resolution utilities with tilde expansion</name>
  <files>src/utils/path-resolver.ts, src/utils/index.ts</files>
  <action>
    1. Create src/utils/path-resolver.ts:
       ```typescript
       import { homedir } from 'os';
       import { join, resolve } from 'path';

       /**
        * Expand tilde (~) in path to user's home directory
        */
       export function expandTilde(filepath: string): string {
         if (filepath.startsWith('~/') || filepath === '~') {
           return join(homedir(), filepath.slice(1));
         }
         return filepath;
       }

       /**
        * Resolve global skills directory path
        */
       export function getGlobalSkillsDir(): string {
         return join(homedir(), '.claude', 'skills');
       }

       /**
        * Resolve project skills directory path (relative to cwd)
        */
       export function getProjectSkillsDir(cwd: string = process.cwd()): string {
         return resolve(cwd, '.claude', 'skills');
       }

       /**
        * Resolve project commands directory path (relative to cwd)
        */
       export function getCommandsDir(cwd: string = process.cwd()): string {
         return resolve(cwd, '.claude', 'commands');
       }
       ```

    2. Create src/utils/index.ts:
       ```typescript
       export * from './path-resolver.js';
       ```

    Note: Use Node.js native os and path modules. No external dependencies needed.
  </action>
  <verify>
    - `npm run build` compiles without errors
    - Manually test: Create a simple test script that imports and calls expandTilde('~/.claude') and logs result
  </verify>
  <done>
    Path utilities work correctly, tilde expands to home directory.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `npm run build` - should compile without errors
2. Check dist/ directory structure matches src/
3. Verify types are exported: `node -e "import('./dist/types/index.js').then(m => console.log(Object.keys(m)))"`
4. Verify path utils work: `node -e "import('./dist/utils/index.js').then(m => console.log(m.expandTilde('~/.claude')))"`
</verification>

<success_criteria>
- TypeScript compiles without errors
- All types exported from src/types/index.ts
- Path resolution utilities work with tilde expansion
- Project structure follows recommended architecture from research
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
